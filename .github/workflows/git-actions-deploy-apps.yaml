# name: Deploy de Aplica√ß√µes no Cluster KIND

# on:
#   workflow_dispatch:
#     inputs:
#       descricao:
#         description: "‚ö†Ô∏è Este workflow instala n8n e n8n_postgres. Confirma a execu√ß√£o?"
#         required: true
#         default: "false"
# jobs:
#   deploy-apps:
#     runs-on: ubuntu-latest

#     steps:
#     - name: üì¶ Checkout do reposit√≥rio
#       uses: actions/checkout@v3

#     - name: üîß Instala depend√™ncias (Ansible + kubectl)
#       run: |
#         echo "::group::üõ†Ô∏è Instalando depend√™ncias"
#         sudo apt-get update
#         sudo apt-get install -y ansible sshpass openssh-client curl
#         curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
#         chmod +x kubectl && sudo mv kubectl /usr/local/bin/
#         echo "::endgroup::"

#     - name: üîê Configura chave SSH da VPS
#       run: |
#         echo "::group::üîê Adicionando chave SSH"
#         mkdir -p ~/.ssh
#         echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/${{ vars.SSH_KEY_FILENAME }}
#         chmod 600 ~/.ssh/${{ vars.SSH_KEY_FILENAME }}
#         ssh-keyscan -H ${{ vars.VPS_HOSTNAME }} >> ~/.ssh/known_hosts
#         echo "‚úÖ Chave SSH configurada"
#         echo "::endgroup::"

#     - name: ‚öôÔ∏è Executa o playbook de deploy de aplica√ß√µes
#       working-directory: ./ansible-hostinger
#       run: |
#         echo "::group::üöÄ Deploy das aplica√ß√µes no cluster KIND"
#         ansible-playbook -i inventory.ini ansible-deploy-apps.yaml
#         echo "::endgroup::"

#     - name: üåê Exibe URL final do n8n
#       run: |
#         scp -o StrictHostKeyChecking=no -i ~/.ssh/hostinger-vps root@srv774237.hstgr.cloud:/tmp/n8n-final-url.txt ./n8n-url.txt
#         echo ""
#         echo "====================== üåê APLICA√á√ÉO DISPON√çVEL ======================"
#         echo ""
#         echo "Seu n8n est√° dispon√≠vel em:"
#         cat ./n8n-url.txt
#         echo ""
#         echo "======================================================================"
